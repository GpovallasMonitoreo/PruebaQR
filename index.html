<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Argos AR: High Fidelity</title>
    
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

    <style>
        body { margin: 0; font-family: 'Courier New', Courier, monospace; overflow: hidden; }
        
        /* UI DE CARGA ELEGANTE */
        #loader-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #111; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s;
        }
        .loader-text { color: #00ffcc; font-size: 18px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #333;
            border-top: 5px solid #00ffcc; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden { opacity: 0; pointer-events: none; }

        /* UI DE ESCANEO */
        #scan-ui {
            position: absolute; bottom: 50px; left: 0; width: 100%; text-align: center;
            pointer-events: none; z-index: 10;
        }
        .scan-msg {
            background: rgba(0, 0, 0, 0.7); color: white; padding: 10px 20px;
            border: 1px solid #00ffcc; border-radius: 4px; display: inline-block;
        }
    </style>

    <script>
        // COMPONENTE PARA LA ENTRADA DRAM√ÅTICA
        AFRAME.registerComponent('dramatic-entry', {
            init: function() {
                const el = this.el;
                el.setAttribute('scale', '0 0 0'); // Empieza invisible/diminuto
                el.setAttribute('visible', 'false');

                const target = document.querySelector('[mindar-image-target]');
                
                target.addEventListener('targetFound', () => {
                    console.log("¬°Objetivo detectado! Iniciando secuencia...");
                    el.setAttribute('visible', 'true');
                    
                    // Animaci√≥n de escala (Pop-up el√°stico)
                    el.removeAttribute('animation'); // Limpiar anteriores
                    el.setAttribute('animation', {
                        property: 'scale',
                        to: '0.4 0.4 0.4', // Tama√±o final (aj√∫stalo si es muy grande)
                        dur: 1500, // Duraci√≥n en ms
                        easing: 'easeOutElastic', // Efecto rebote
                        elasticity: 400
                    });
                });

                target.addEventListener('targetLost', () => {
                    // Opcional: Ocultarlo de nuevo para que vuelva a salir al re-escanear
                    el.setAttribute('scale', '0 0 0');
                    el.setAttribute('visible', 'false');
                });
            }
        });
    </script>
</head>
<body>

    <div id="loader-overlay">
        <div class="loader-text">Cargando Modelo HD...</div>
        <div class="spinner"></div>
    </div>

    <div id="scan-ui" class="hidden">
        <div class="scan-msg">üì° ENFOCA LA PANTALLA</div>
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: ./targets.mind; uiLoading: no; uiScanning: no;" 
        color-space="sRGB" 
        renderer="colorManagement: true, physicallyCorrectLights, highRefreshRate: true" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">

        <a-assets>
            <a-asset-item id="brainstem-model" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/BrainStem/glTF-Binary/BrainStem.glb"></a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity mindar-image-target="targetIndex: 0">
            
            <a-light type="directional" position="1 4 2" intensity="1.2" castShadow="true"></a-light>
            <a-light type="ambient" intensity="0.3"></a-light>
            <a-light type="point" position="-2 1 2" color="#00ffcc" intensity="0.8"></a-light> <a-entity 
                id="monster"
                gltf-model="#brainstem-model" 
                rotation="0 0 0" 
                position="0 -0.8 0" 
                dramatic-entry
                animation-mixer="clip: *; loop: repeat; timeScale: 1">
            </a-entity>

        </a-entity>
    </a-scene>

    <script>
        // SCRIPT PARA QUITAR LA PANTALLA DE CARGA CUANDO TODO EST√â LISTO
        const scene = document.querySelector('a-scene');
        const loader = document.querySelector('#loader-overlay');
        const scanUI = document.querySelector('#scan-ui');

        scene.addEventListener('loaded', () => {
            console.log("Escena cargada (Assets listos)");
            // A veces el evento loaded se dispara antes de que MindAR est√© listo, damos un peque√±o margen
            setTimeout(() => {
                loader.classList.add('hidden');
                scanUI.classList.remove('hidden');
            }, 1000);
        });

        // Manejo de errores de c√°mara
        scene.addEventListener('arError', (event) => {
            loader.innerHTML = "<div style='color:red; padding:20px; text-align:center'>ERROR DE C√ÅMARA<br>Revisa HTTPS y Permisos</div>";
        });
    </script>
</body>
</html>
